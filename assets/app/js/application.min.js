!function(a){"use strict";function b(a,b){return Math.floor(Math.random()*(b-a))+a}function c(){v.attr("patternTransform","translate("+d3.event.translate+") scale("+d3.event.scale+")"),u.select("path").attr("stroke-width",.5/d3.event.scale),v.select("path").attr("stroke-width",1/d3.event.scale),E.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")}function d(){d3.event.sourceEvent.stopPropagation(),d3.select(this).classed("dragging",!0)}function e(){d3.select(this).attr("x",d3.event.x).attr("y",d3.event.y),A.attr("x1",Number(z.attr("x"))+23.5).attr("y1",Number(z.attr("y"))+.5).attr("x2",Number(y.attr("x"))+45).attr("y2",Number(y.attr("y"))+163),B.attr("x1",Number(w.attr("x"))+.5).attr("y1",Number(w.attr("y"))+25).attr("x2",Number(z.attr("x"))+4.5).attr("y2",Number(z.attr("y"))+29.5),C.attr("x1",Number(w.attr("x"))+163.5).attr("y1",Number(w.attr("y"))+25).attr("x2",Number(y.attr("x"))+55).attr("y2",Number(y.attr("y"))+163)}function f(){d3.select(this).classed("dragging",!1)}function g(a,b){var c=new jQuery.Deferred;return d3.xml(a,"image/svg+xml",function(a){F[b]=a.documentElement,c.resolve()}),c.promise()}function h(){var a=[];return a.push(g("assets/app/img/components/aa-battery.svg","aaBattery")),a.push(g("assets/app/img/components/breadboard.svg","breadboard")),a.push(g("assets/app/img/components/light-bulb.svg","lightBulb")),a.push(g("assets/app/img/components/pushbutton.svg","pushbutton")),a}var i="canvas",j="100%",k="100%",l="grid",m=80,n="none",o="#ddd",p=1,q=!0,r=d3.behavior.zoom().scaleExtent([.5,4]).on("zoom",c),s=d3.behavior.drag().origin(function(){return{x:d3.select(this).attr("x"),y:d3.select(this).attr("y")}}).on("dragstart",d).on("drag",e).on("dragend",f),t=d3.select("#viewport").append("svg:svg").attr("id",i).attr("width",j).attr("height",k).call(r).on("mousedown",function(){t.style("cursor","grabbing")}).on("mouseup",function(){t.style("cursor","grab")}).style("cursor","grab"),u=t.append("defs"),v=u.append("pattern").attr("id","grid-inner").attr("width",8).attr("height",8).attr("patternUnits","userSpaceOnUse");v.append("path").attr("d","M 8 0 L 0 0 0 8").attr("fill",n).attr("stroke","#eee").attr("stroke-width",.5),v=u.append("pattern").attr("id",l).attr("width",m).attr("height",m).attr("patternUnits","userSpaceOnUse"),v.append("rect").attr("fill","url(#grid-inner)").attr("width",m).attr("height",m),v.append("path").attr("d","M "+m+" 0 L 0 0 0 "+m).attr("fill",n).attr("stroke",o).attr("stroke-width",p);var w,x,y,z,A,B,C,D=t.append("rect").attr("width",j).attr("height",k).attr("fill","url(#"+l+")"),E=t.append("g").classed("editing",q),F={};a.when.apply(a,h()).then(function(){var c;c=E.node().appendChild(F.breadboard),x=d3.select(c).attr("class","component").attr("width",660).attr("height",220).attr("x",b(0,a(t[0]).width()-660)).attr("y",b(0,a(t[0]).height()-220)).call(s),c=E.node().appendChild(F.aaBattery),w=d3.select(c).attr("class","component").attr("width",164).attr("height",50).attr("x",b(0,a(t[0]).width()-164)).attr("y",b(0,a(t[0]).height()-50)).call(s),c=E.node().appendChild(F.lightBulb),y=d3.select(c).attr("class","component off").attr("width",100).attr("height",164).attr("x",b(0,a(t[0]).width()-100)).attr("y",b(0,a(t[0]).height()-164)).call(s),c=E.node().appendChild(F.pushbutton),z=d3.select(c).attr("class","component").attr("width",28).attr("height",30).attr("x",b(0,a(t[0]).width()-28)).attr("y",b(0,a(t[0]).height()-30)).call(s),A=E.append("line").attr("stroke","#f00").attr("stroke-width",3).attr("stroke-linecap","round").attr("x1",Number(z.attr("x"))+23.5).attr("y1",Number(z.attr("y"))+.5).attr("x2",Number(y.attr("x"))+45).attr("y2",Number(y.attr("y"))+163),B=E.append("line").attr("stroke","#f00").attr("stroke-width",3).attr("stroke-linecap","round").attr("x1",Number(w.attr("x"))+.5).attr("y1",Number(w.attr("y"))+25).attr("x2",Number(z.attr("x"))+4.5).attr("y2",Number(z.attr("y"))+29.5),C=E.append("line").attr("stroke","#f00").attr("stroke-width",3).attr("stroke-linecap","round").attr("x1",Number(w.attr("x"))+163.5).attr("y1",Number(w.attr("y"))+25).attr("x2",Number(y.attr("x"))+55).attr("y2",Number(y.attr("y"))+163)}),a("#field-search").keyup(function(){var b=a(this).val().toLowerCase();a(".component-library .component-library-item").show().filter(function(){return-1===a(".caption",this).text().trim().toLowerCase().indexOf(b)}).hide()}),ace.edit("code-editor"),a("#reset-view").click(function(a){a.preventDefault(),r.scale(1),r.translate([0,0]),v.attr("patternTransform",null),E.attr("transform",null)}),a("#toggle-grid").click(function(b){b.preventDefault(),a(D[0]).toggle()}),a("#toggle-simulation").click(function(b){b.preventDefault(),q=!q,a(".glyphicon",this).toggleClass("glyphicon-play glyphicon-stop"),E.classed("editing",q),q?(z.on("mousedown",null).on("mouseup",null),x.call(s),w.call(s),y.call(s),z.call(s)):(x.on(".drag",null),w.on(".drag",null),y.on(".drag",null),z.on(".drag",null),z.on("mousedown",function(){z.classed("pressed",!0),y.classed("off",!1)}).on("mouseup",function(){z.classed("pressed",!1),y.classed("off",!0)}))}),a.whenAllDone=function(){var b=[],c=a.Deferred();return a.each(arguments,function(c,d){var e=a.Deferred();d.always(function(){e.resolve()}),b.push(e.promise())}),a.when.apply(null,b).always(function(){return c.resolve()}),c.promise()};var G={categories:[]};a.get("assets/vendor/fritzing-parts/bins/core.fzb",function(b){var c=a.parseXML(b),d=a(c);d.find("instance").each(function(){var b,c,d=(a(this),a(this).attr("moduleIdRef"));if((c=G.categories.length)&&(b=G.categories[c-1]),"__spacer__"==d)b={components:[]},b.name=a(this).attr("path"),G.categories.push(b);else{var e;(e=a(this).attr("path"))?b.components.push(e.split("/").pop()):b.components.push(d+".fzp")}});for(var e=[],f=0;f<G.categories.length;f++)for(var g=0;g<G.categories[f].components.length;g++)e.push(function(b,c){return a.get("assets/vendor/fritzing-parts/core/"+G.categories[b].components[c],function(d){var e={};try{var f=a.parseXML(d),g=a(f);e.title=g.find("module > title").text(),e.icon="assets/vendor/fritzing-parts/svg/core/"+g.find("module > views > iconView > layers").attr("image"),e.description=g.find("module > description").text(),e.properties={},g.find("module > properties > property").each(function(){var b=a(this),c=b.attr("name").toLowerCase();e.properties[c]=b.text().toLowerCase()}),e.tags=[],g.find("module > tags > tag").each(function(){e.tags.push(a(this).text().toLowerCase())})}catch(h){e.title=G.categories[b].components[c],e.error="parse error"}G.categories[b].components[c]=e}).fail(function(){G.categories[b].components[c]={title:G.categories[b].components[c],error:"not found"}})}(f,g));a.whenAllDone.apply(null,e).always(function(){var b=a("#categories-template").html(),c=Handlebars.compile(b),d=G,e=c(d);a("#categories-template").after(e),b=a("#components-template").html(),c=Handlebars.compile(b),e=c(d),a("#components-template").after(e)})}),a(".component-library").on({mouseenter:function(){var b=a(this),c=b.data("category"),d=b.data("id"),e=a("#component-overview-template").html(),f=Handlebars.compile(e),g=G.categories[c].components[d],h=f(g);a("#component-overview-template").after(h),a("#component-inspector").addClass("active")},mouseleave:function(){a("#component-overview").remove(),a("#component-inspector").removeClass("active")}},".thumbnail")}(jQuery);